# Test 1: 기본 Ambassador 패턴 - 로그 프록시
# 원본 예제: https://github.com/k8spatterns/examples/tree/main/structural/Ambassador

apiVersion: v1
kind: Pod
metadata:
  name: random-generator
  labels:
    app: random-generator
    test: ambassador-basic
spec:
  containers:
  # 메인 애플리케이션 컨테이너
  - name: main
    image: k8spatterns/random-generator:1.0
    env:
    # Ambassador와 통신하기 위한 URL - localhost 사용
    - name: LOG_URL
      value: http://localhost:9009
    ports:
    - containerPort: 8080
      protocol: TCP
    resources:
      requests:
        memory: "64Mi"
        cpu: "100m"
      limits:
        memory: "128Mi"
        cpu: "200m"

  # Ambassador 컨테이너 - 로그를 받아서 처리
  - name: ambassador
    image: k8spatterns/random-generator-log-ambassador
    resources:
      requests:
        memory: "32Mi"
        cpu: "50m"
      limits:
        memory: "64Mi"
        cpu: "100m"

---
apiVersion: v1
kind: Service
metadata:
  name: random-generator
  labels:
    test: ambassador-basic
spec:
  type: NodePort
  selector:
    app: random-generator
  ports:
  - name: http
    port: 8080
    targetPort: 8080
    protocol: TCP
