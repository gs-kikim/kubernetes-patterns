apiVersion: v1
kind: Pod
metadata:
  name: permission-test
  labels:
    test: permission
spec:
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  initContainers:
  - name: config-init
    image: k8spatterns/immutable-config-dev:1.0
    imagePullPolicy: Never
    args: ["/config"]
    volumeMounts:
    - name: config-volume
      mountPath: /config
  containers:
  - name: app
    image: busybox:1.36
    command:
    - sh
    - -c
    - |
      echo "=== File Permissions Check ==="
      ls -la /app/config/
      echo ""
      echo "=== Current User ==="
      id
      echo ""
      echo "=== Reading Configuration ==="
      cat /app/config/app.properties
      echo ""
      echo "Permission test completed successfully"
      sleep 300
    volumeMounts:
    - name: config-volume
      mountPath: /app/config
      readOnly: true
  volumes:
  - name: config-volume
    emptyDir: {}
