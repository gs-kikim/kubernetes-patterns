# Test: readOnlyRootFilesystem + emptyDir 볼륨
# 목적: 읽기 전용 FS와 쓰기 가능 볼륨의 조합 검증
# 예상 결과: nginx 정상 실행, / 경로 쓰기 불가, /tmp 등은 쓰기 가능
# 검증:
#   kubectl exec readonly-success -- touch /test.txt (실패)
#   kubectl exec readonly-success -- touch /tmp/test.txt (성공)

apiVersion: v1
kind: Pod
metadata:
  name: readonly-success
  labels:
    test: filesystem
    scenario: readonly-with-volumes
spec:
  securityContext:
    runAsUser: 101
    runAsNonRoot: true
    fsGroup: 101
  containers:
  - name: nginx
    image: nginx:1.25
    securityContext:
      readOnlyRootFilesystem: true  # 루트 FS 읽기 전용
      allowPrivilegeEscalation: false
      capabilities:
        drop: ['ALL']
        add: ['NET_BIND_SERVICE']
    volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: var-run
      mountPath: /var/run
    - name: var-cache
      mountPath: /var/cache/nginx
  volumes:
  - name: tmp
    emptyDir: {}
  - name: var-run
    emptyDir: {}
  - name: var-cache
    emptyDir: {}
