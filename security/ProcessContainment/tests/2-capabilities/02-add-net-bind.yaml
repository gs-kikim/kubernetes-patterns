# Test: NET_BIND_SERVICE Capability 추가
# 목적: 특정 capability 선택적 부여 검증
# 예상 결과: 포트 80 바인딩 성공, 다른 특권 작업 실패
# 검증: kubectl exec net-bind-caps -- cat /proc/1/status | grep CapEff
#       CapEff: 0000000000000400 (NET_BIND_SERVICE만 설정됨)

apiVersion: v1
kind: Pod
metadata:
  name: net-bind-caps
  labels:
    test: capabilities
    scenario: net-bind-service
spec:
  securityContext:
    runAsUser: 1000
    runAsNonRoot: true
  containers:
  - name: web-server
    image: python:3.11-alpine
    command:
    - sh
    - -c
    - |
      echo "Testing NET_BIND_SERVICE capability..."
      echo "Starting HTTP server on port 80 (requires NET_BIND_SERVICE)..."
      python3 -m http.server 80
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop: ['ALL']
        add: ['NET_BIND_SERVICE']  # 1024 이하 포트 바인딩 권한만 추가
