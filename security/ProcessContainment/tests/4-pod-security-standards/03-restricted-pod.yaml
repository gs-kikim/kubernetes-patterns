# Test: Restricted 준수 Pod
# 목적: restricted 정책을 만족하는 Pod 검증
# 예상 결과: 모든 네임스페이스에서 생성 성공
# 테스트:
#   kubectl apply -f 03-restricted-pod.yaml -n pss-restricted  # 성공
#   kubectl apply -f 03-restricted-pod.yaml -n pss-baseline    # 성공
#   kubectl apply -f 03-restricted-pod.yaml -n pss-privileged  # 성공

apiVersion: v1
kind: Pod
metadata:
  name: restricted-pod
  labels:
    test: pss
    scenario: restricted
spec:
  securityContext:
    runAsNonRoot: true        # restricted 필수
    runAsUser: 1000
    seccompProfile:
      type: RuntimeDefault    # restricted 필수
  containers:
  - name: app
    image: busybox:1.36
    command: ['sh', '-c', 'sleep 3600']
    securityContext:
      allowPrivilegeEscalation: false  # restricted 필수
      readOnlyRootFilesystem: true     # 권장 사항
      capabilities:
        drop: ['ALL']                  # restricted 필수
    volumeMounts:
    - name: tmp
      mountPath: /tmp
  volumes:
  - name: tmp
    emptyDir: {}  # restricted에서 허용되는 볼륨 타입
