# Test: Capabilities 검증용 Pod
# 목적: 다양한 capabilities의 효과를 테스트하기 위한 유틸리티 Pod
# 사용법: 이 Pod를 사용하여 특정 작업이 차단되는지 확인

apiVersion: v1
kind: Pod
metadata:
  name: cap-verify
  labels:
    test: capabilities
    scenario: verification
spec:
  securityContext:
    runAsUser: 1000
    runAsNonRoot: true
  containers:
  - name: tester
    image: alpine:3.19
    command:
    - sh
    - -c
    - |
      apk add --no-cache libcap
      echo "=== Current Capabilities ==="
      cat /proc/1/status | grep Cap
      echo ""
      echo "=== Decoded Capabilities ==="
      capsh --decode=$(grep CapEff /proc/1/status | awk '{print $2}')
      echo ""
      echo "Sleeping for manual tests..."
      sleep 3600
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop: ['ALL']
